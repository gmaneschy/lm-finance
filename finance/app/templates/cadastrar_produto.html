{% extends 'base.html' %}
{% load static %}

{% block title %}Sistema Financeiro - Cadastro de Produto{% endblock %}
{% block content %}
<div class="cadastro-produto-container">
    <h2>Cadastrar Produto</h2>

    <form method="POST" id="produto-form">
        {% csrf_token %}
        {{ formset.management_form }}

        <div class="form-container">
            <!-- ========== COLUNA 1: PRODUTO ========== -->
            <div class="coluna coluna-produto">
                <h3>ðŸ“¦ Produto</h3>

                <div class="campo">
                    {{ produto_form.nome.label_tag }}
                    {{ produto_form.nome }}
                </div>

                <div class="campo">
                    {{ produto_form.categoria.label_tag }}
                    {{ produto_form.categoria }}
                </div>

                <div class="campo">
                    {{ produto_form.quantidade_em_estoque.label_tag }}
                    {{ produto_form.quantidade_em_estoque }}
                </div>

                <div class="campo campo-destaque">
                    {{ produto_form.custo_total_estimado.label_tag }}
                    {{ produto_form.custo_total_estimado }}
                    <small class="help-text">Calculado automaticamente</small>
                </div>

                <div class="campo">
                    {{ produto_form.valor_venda.label_tag }}
                    {{ produto_form.valor_venda }}
                </div>

                <div class="campo campo-destaque">
                    {{ produto_form.lucro_por_venda.label_tag }}
                    {{ produto_form.lucro_por_venda }}
                    <small class="help-text">Valor de venda - Custo total</small>
                </div>
            </div>

            <!-- ========== COLUNA 2: MATERIAIS USADOS ========== -->
            <div class="coluna coluna-materiais">
                <h3>ðŸŽ¨ Materiais Usados</h3>

                <div id="materiais-formset">
                    {% for form in formset %}
                    <div class="material-item" data-form-index="{{ forloop.counter0 }}">
                        {{ form.id }}
                        {{ form.DELETE }}

                        <button type="button" class="btn-remover-material" title="Remover material">
                            <span class="icon-x">âœ•</span>
                        </button>

                        <div class="campo">
                            {{ form.compra_materia_prima.label_tag }}
                            {{ form.compra_materia_prima }}
                        </div>

                        <div class="campo-linha">
                            <div class="campo campo-metade">
                                {{ form.tipo_unidade.label_tag }}
                                {{ form.tipo_unidade }}
                            </div>

                            <div class="campo campo-metade">
                                {{ form.qtd_material_usado.label_tag }}
                                {{ form.qtd_material_usado }}
                            </div>
                        </div>

                        <div class="valor-material">
                            <small>Valor: R$ <span class="valor-material-span">0.00</span></small>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <button type="button" id="add-material" class="btn-adicionar">
                    <span>âž•</span> Adicionar Material
                </button>

                <div class="resumo-materiais">
                    <div class="linha-resumo">
                        <span>Total Materiais:</span>
                        <strong>R$ <span id="total-materiais">0.00</span></strong>
                    </div>
                </div>
            </div>

            <!-- ========== COLUNA 3: CUSTOS FIXOS ========== -->
            <div class="coluna coluna-custos">
                <h3>ðŸ”§ Custos Fixos</h3>


                <div class="campo">
                    {{ custo_fixo_form.energia.label_tag }}
                    {{ custo_fixo_form.energia }}
                </div>

                <div class="campo">
                    {{ custo_fixo_form.cola.label_tag }}
                    {{ custo_fixo_form.cola }}
                </div>

                <div class="campo">
                    {{ custo_fixo_form.isqueiro.label_tag }}
                    {{ custo_fixo_form.isqueiro }}
                </div>

                <div class="campo">
                    {{ custo_fixo_form.das_mei.label_tag }}
                    {{ custo_fixo_form.das_mei }}
                </div>

                <div class="campo">
                    {{ custo_fixo_form.taxas_bancarias.label_tag }}
                    {{ custo_fixo_form.taxas_bancarias }}
                </div>
                <div class="header-custos">
                    <label class="toggle-bloqueio">
                        <input type="checkbox" id="id_custos_bloqueados" checked>
                        <span class="icone-cadeado">ðŸ”’</span>
                        <span class="texto-bloqueio">Bloqueado</span>
                    </label>
                </div>
                <div class="resumo-custos">
                    <div class="linha-resumo">
                        <span>Total Custos Fixos:</span>
                        <strong>R$ <span id="total-custos-fixos">0.00</span></strong>
                    </div>
                </div>

            </div>
        </div>

        <div class="botao-centro">
            <button type="submit" class="btn-salvar">
                <span class="heroicons-outline--save-as"></span>Salvar Produto</button>
        </div>
    </form>
</div>

{% block scripts %}

<!-- Dados dos materiais para JavaScript -->
<link rel="stylesheet" href="{% static 'css/cadastrar_produto.css' %}">
<link rel="stylesheet" href="{% static 'css/global.css' %}">
<script src="{% static 'js/cadastrar_produto.js' %}"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script id="materiais-data" type="application/json">{{ materiais_data_json|safe }}</script>
{% endblock %}
{% endblock %}